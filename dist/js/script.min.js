import codes from"./phone.js";function testWebP(e){let t=new Image;t.onload=t.onerror=function(){e(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}testWebP((function(e){1==e?document.querySelector("body").classList.add("webp"):document.querySelector("body").classList.add("no-webp")}));const selectCountry=document.querySelector("#dropdown");function fillCountries(){codes.forEach(e=>{const t=document.createElement("div");t.classList.add("country__item"),t.innerHTML=e.name,selectCountry.appendChild(t)})}fillCountries();const buttonCountry=document.querySelector("#country"),optionsCountry=document.querySelectorAll(".country__item"),selectLabel=document.querySelector("#select-label"),phone=document.querySelector(".input__phone");function toggleHidden(){selectCountry.classList.toggle("hidden")}function applyState(){const e=window.location.href,t=e.lastIndexOf("#");let n="";t>=0&&(n=e.slice(t+1)),"main"==n?($(".active__wrapper-form").show(),$(".active__wrapper-access").hide(),$(".active__wrapper-final").hide()):"questionaire"==n?($(".active__wrapper-form").hide(),$(".active__wrapper-access").show(),$(".active__wrapper-final").hide()):"last"==n&&($(".active__wrapper-form").hide(),$(".active__wrapper-access").hide(),$(".active__wrapper-final").show())}function pasteData(e){const t=e.country_code,n=codes.find(e=>e.countryCode==t);phone.value=n.Iso,selectLabel.value=n.name}buttonCountry.addEventListener("click",(function(e){e.preventDefault(),toggleHidden()})),optionsCountry.forEach((function(e){e.addEventListener("click",(function(e){const t=codes.find(t=>t.name==e.target.innerText);selectLabel.value=e.target.innerText,phone.value=t.Iso,toggleHidden();selectCountry.querySelectorAll(".hidden").forEach(e=>{e.classList.remove("hidden")})}))})),window.location.href="#main",window.onpopstate=applyState,$.ajax({url:"https://geolocation-db.com/jsonp",jsonpCallback:"callback",dataType:"jsonp",success:pasteData,error:()=>{throw new Error("Get country failed")}}),selectLabel.oninput=()=>{let e=selectLabel.value,t=new RegExp(e,"gi");optionsCountry.forEach(e=>{e.innerText.search(t)>=0?e.classList.remove("hidden"):e.classList.add("hidden")})};const formData={name:"",mail:"",phone:"",country:""};$("#form-submit").click(e=>{e.preventDefault;let t=!0;$("#form input").each((function(e,n){!0!==n.checkValidity()?(t=!1,$(n).css("boxShadow","0 0 3px red")):$(n).css("boxShadow","none")})),t&&(formData.name=$(".input__name").val(),formData.mail=$(".input__email").val(),formData.phone=$(".input__phone").val(),formData.country=$(".country__input").val(),$(".active__wrapper-form").hide(),$(".active__wrapper-access").show("fast"),window.location.href="#questionaire")}),$(".question__link-button").click(e=>{e.preventDefault(),$(".active__wrapper-access").hide(),$(".active__wrapper-questionaire").show(),window.history.pushState(null,"",window.location.href),window.onpopstate=function(){window.history.pushState(null,"",window.location.href)}});const answers={1:null,2:null,3:null,4:null};let question=1;function postData(){let e=formData,t="";for(let e in answers)answers[e]&&(t+=`Question -${e}: ${answers[e]};`);e.answers=t,$.ajax({type:"POST",url:"server.php",data:JSON.stringify(e)})}$(".questionaire__option").each((e,t)=>{$(t).click(()=>{answers[question]=e+1,question++,question<=4?$(".questionaire__option").each((e,t)=>{$(t).children(`.picture:eq(${question-2})`).hide(),$(t).children(`.picture:eq(${question-1})`).fadeIn(),$(t).children(`.questionaire__answer:eq(${question-2})`).hide(),$(t).children(`.questionaire__answer:eq(${question-1})`).fadeIn(),$(".questionaire__pagination").text(`Question ${question} of 4`),$(".questionaire").children(`h2:eq(${question-2})`).hide(),$(".questionaire").children(`h2:eq(${question-1})`).show(),$(".progressbar__list").children(`li:eq(${question-1})`).addClass("item_active")}):($(".active__wrapper-questionaire").hide(),$(".active__wrapper-final").show(),window.location.href="#last",window.onpopstate=applyState,postData()),2==question&&postData()})});